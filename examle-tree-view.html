<head></head>

<body>
    <div id="tree"></div>

    <script type="text/javascript" src="http://www.getorgchart.com/GetOrgChart/getorgchart/getorgchart.js"></script>
    <link rel="stylesheet" type="text/css" href="http://www.getorgchart.com/GetOrgChart/getorgchart/getorgchart.css">
    <link rel="stylesheet" type="text/css" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <script type="text/javascript">
    var my_tree_data = [{
            "id": 1,
            "name": "root",
            "parentId": null,
            "level": 0,
            "left_node": 2,
            "right_node": 5,
            "left_points": "Баллы в левой ноге - 1950",
            "right_points": "Баллы в правой ноге - 0",
            "status": "4",
            "created": "2018-06-28T16:34:14.720",
            "look_tree": "<a class='look_tree' href='#root'><i class='fa fa-3x fa-chevron-down'></i></a>"
        },
        {
            "id": 5,
            "name": "mptt",
            "parentId": 1,
            "level": 1,
            "left_node": false,
            "right_node": false,
            "left_points": "Баллы в левой ноге - 0",
            "right_points": "Баллы в правой ноге - 0",
            "status": "1",
            "created": "2018-07-02T14:55:14.665",
            "look_tree": "<a class='look_tree' href='#mptt'><i class='fa fa-3x fa-chevron-down'></i></a>"
        },
        {
            "id": 2,
            "name": "test-1",
            "parentId": 1,
            "level": 1,
            "left_node": 3,
            "right_node": 4,
            "left_points": "Баллы в левой ноге - 150",
            "right_points": "Баллы в правой ноге - 1800",
            "status": "4",
            "created": "2018-06-28T16:34:39.059",
            "look_tree": "<a class='look_tree' href='#test-1'><i class='fa fa-3x fa-chevron-down'></i></a>"
        },
        {
            "id": 3,
            "name": "test-2",
            "parentId": 2,
            "level": 2,
            "left_node": false,
            "right_node": 12,
            "left_points": "Баллы в левой ноге - 0",
            "right_points": "Баллы в правой ноге - 150",
            "status": "3",
            "created": "2018-06-28T16:35:22.943",
            "look_tree": "<a class='look_tree' href='#test-2'><i class='fa fa-3x fa-chevron-down'></i></a>"
        },
        {
            "id": 12,
            "name": "super",
            "parentId": 3,
            "level": 3,
            "left_node": false,
            "right_node": false,
            "left_points": "Баллы в левой ноге - 0",
            "right_points": "Баллы в правой ноге - 0",
            "status": "1",
            "created": "2018-07-02T17:53:43.671",
            "look_tree": "<a class='look_tree' href='#super'><i class='fa fa-3x fa-chevron-down'></i></a>"
        },
        {
            "id": 4,
            "name": "test-4",
            "parentId": 2,
            "level": 2,
            "left_node": false,
            "right_node": 6,
            "left_points": "Баллы в левой ноге - 0",
            "right_points": "Баллы в правой ноге - 1800",
            "status": "2",
            "created": "2018-06-28T16:35:34.800",
            "look_tree": "<a class='look_tree' href='#test-4'><i class='fa fa-3x fa-chevron-down'></i></a>"
        },
        {
            "id": 6,
            "name": "zheka",
            "parentId": 4,
            "level": 3,
            "left_node": 7,
            "right_node": 8,
            "left_points": "Баллы в левой ноге - 1400",
            "right_points": "Баллы в правой ноге - 400",
            "status": "4",
            "created": "2018-07-02T16:46:50.776",
            "look_tree": "<a class='look_tree' href='#zheka'><i class='fa fa-3x fa-chevron-down'></i></a>"
        },
        {
            "id": 8,
            "name": "alena",
            "parentId": 6,
            "level": 4,
            "left_node": 10,
            "right_node": 9,
            "left_points": "Баллы в левой ноге - 100",
            "right_points": "Баллы в правой ноге - 300",
            "status": "4",
            "created": "2018-07-02T16:48:00.076",
            "look_tree": "<a class='look_tree' href='#alena'><i class='fa fa-3x fa-chevron-down'></i></a>"
        },
        {
            "id": 9,
            "name": "anton",
            "parentId": 8,
            "level": 5,
            "left_node": false,
            "right_node": false,
            "left_points": "Баллы в левой ноге - 0",
            "right_points": "Баллы в правой ноге - 0",
            "status": "1",
            "created": "2018-07-02T16:49:16.461",
            "look_tree": "<a class='look_tree' href='#anton'><i class='fa fa-3x fa-chevron-down'></i></a>"
        },
        {
            "id": 10,
            "name": "tema",
            "parentId": 8,
            "level": 5,
            "left_node": false,
            "right_node": false,
            "left_points": "Баллы в левой ноге - 0",
            "right_points": "Баллы в правой ноге - 0",
            "status": "1",
            "created": "2018-07-02T16:50:18.384",
            "look_tree": "<a class='look_tree' href='#tema'><i class='fa fa-3x fa-chevron-down'></i></a>"
        },
        {
            "id": 7,
            "name": "slava",
            "parentId": 6,
            "level": 4,
            "left_node": 11,
            "right_node": false,
            "left_points": "Баллы в левой ноге - 1400",
            "right_points": "Баллы в правой ноге - 0",
            "status": "1",
            "created": "2018-07-02T16:47:34.425",
            "look_tree": "<a class='look_tree' href='#slava'><i class='fa fa-3x fa-chevron-down'></i></a>"
        },
        {
            "id": 11,
            "name": "qwerty",
            "parentId": 7,
            "level": 5,
            "left_node": false,
            "right_node": 13,
            "left_points": "Баллы в левой ноге - 0",
            "right_points": "Баллы в правой ноге - 1350",
            "status": "1",
            "created": "2018-07-02T16:51:19.220",
            "look_tree": "<a class='look_tree' href='#qwerty'><i class='fa fa-3x fa-chevron-down'></i></a>"
        },
        {
            "id": 13,
            "name": "super-2",
            "parentId": 11,
            "level": 6,
            "left_node": false,
            "right_node": 14,
            "left_points": "Баллы в левой ноге - 0",
            "right_points": "Баллы в правой ноге - 1200",
            "status": "1",
            "created": "2018-07-02T18:34:05.361",
            "look_tree": "<a class='look_tree' href='#super-2'><i class='fa fa-3x fa-chevron-down'></i></a>"
        },
        {
            "id": 14,
            "name": "kostia",
            "parentId": 13,
            "level": 7,
            "left_node": false,
            "right_node": 15,
            "left_points": "Баллы в левой ноге - 0",
            "right_points": "Баллы в правой ноге - 1050",
            "status": "1",
            "created": "2018-07-02T18:34:19.153",
            "look_tree": "<a class='look_tree' href='#kostia'><i class='fa fa-3x fa-chevron-down'></i></a>"
        },
        {
            "id": 15,
            "name": "nastia",
            "parentId": 14,
            "level": 8,
            "left_node": 16,
            "right_node": false,
            "left_points": "Баллы в левой ноге - 900",
            "right_points": "Баллы в правой ноге - 0",
            "status": "1",
            "created": "2018-07-02T18:34:29.321",
            "look_tree": "<a class='look_tree' href='#nastia'><i class='fa fa-3x fa-chevron-down'></i></a>"
        },
        {
            "id": 16,
            "name": "maria",
            "parentId": 15,
            "level": 9,
            "left_node": 17,
            "right_node": false,
            "left_points": "Баллы в левой ноге - 750",
            "right_points": "Баллы в правой ноге - 0",
            "status": "1",
            "created": "2018-07-02T18:34:43.640",
            "look_tree": "<a class='look_tree' href='#maria'><i class='fa fa-3x fa-chevron-down'></i></a>"
        },
        {
            "id": 17,
            "name": "olga",
            "parentId": 16,
            "level": 10,
            "left_node": 18,
            "right_node": false,
            "left_points": "Баллы в левой ноге - 600",
            "right_points": "Баллы в правой ноге - 0",
            "status": "1",
            "created": "2018-07-02T18:35:40.631",
            "look_tree": "<a class='look_tree' href='#olga'><i class='fa fa-3x fa-chevron-down'></i></a>"
        },
        {
            "id": 18,
            "name": "sergey",
            "parentId": 17,
            "level": 11,
            "left_node": 19,
            "right_node": false,
            "left_points": "Баллы в левой ноге - 450",
            "right_points": "Баллы в правой ноге - 0",
            "status": "1",
            "created": "2018-07-02T18:35:50.120",
            "look_tree": "<a class='look_tree' href='#sergey'><i class='fa fa-3x fa-chevron-down'></i></a>"
        },
        {
            "id": 19,
            "name": "anna",
            "parentId": 18,
            "level": 12,
            "left_node": false,
            "right_node": 20,
            "left_points": "Баллы в левой ноге - 0",
            "right_points": "Баллы в правой ноге - 300",
            "status": "1",
            "created": "2018-07-02T18:36:01.338",
            "look_tree": "<a class='look_tree' href='#anna'><i class='fa fa-3x fa-chevron-down'></i></a>"
        },
        {
            "id": 20,
            "name": "boris",
            "parentId": 19,
            "level": 13,
            "left_node": false,
            "right_node": 21,
            "left_points": "Баллы в левой ноге - 0",
            "right_points": "Баллы в правой ноге - 150",
            "status": "1",
            "created": "2018-07-02T18:36:12.899",
            "look_tree": "<a class='look_tree' href='#boris'><i class='fa fa-3x fa-chevron-down'></i></a>",
            "skip_children": true
        }
    ];

    var not_active = {};

    function traverseTree(orgChart, inputArray) {
        return traverseNode(orgChart, inputArray, outputArray, inputArray[0].id);
    }

    function generateRootNode(inputArray) {
        var node = inputArray[0];
        node.fakeId = 0;
        node.fakeParentId = null;
        return JSON.parse(JSON.stringify(node));
    }

    function getChildId(parentId, isLeftBranch) {
        return parentId * 100000 + isLeftBranch;
    }

    function mockUnit(parentId, isLeftBranch) {
        var magic = 16777213;
        return {
            id: -1,
            parentId: parentId,
            name: null,
            package: null,
            left: 0,
            right: 0,
            image: null,
            left_node: null,
            right_node: null
        };
    }
    var nodes_customize = {};

    function traverseNode(orgChart, inputArray, outputArray, nodeId, parentId, isLeftBranch) {
        var node = inputArray.find(function(item) {
            return (Number(item.id) === Number(nodeId));
        });
        var mock;

        if (!node) {
            throw new Error('Node ID ' + nodeId + ' is not present!');
        }

        if (node.parentId) {
            node.fakeId = getChildId(node.parentId, isLeftBranch);
            node.fakeParentId = parentId;
            outputArray.push(node);
        }

        if (node.status == "1") {
            nodes_customize[node.fakeId] = { color: "neutralgrey" };
        } else if (node.status == "2") {
            nodes_customize[node.fakeId] = { color: "teal" };
        } else if (node.status == "3") {
            nodes_customize[node.fakeId] = { color: "cordovan" };
        } else if (node.status == "4") {
            nodes_customize[node.fakeId] = { color: "green" };
        } else {
            nodes_customize[node.fakeId] = { color: "black" };
        }

        if (!node.left_node) {
            mock = mockUnit(nodeId, 0);
            mock.fakeId = getChildId(node.id, 0);
            nodes_customize[getChildId(node.id, 0)] = { theme: "helen" };
            mock.fakeParentId = node.fakeId;
            outputArray.push(mock);
        } else if (!node.skip_children) {
            traverseNode(orgChart, inputArray, outputArray, node.left_node, node.fakeId, 0);
        }

        if (!node.right_node) {
            mock = mockUnit(nodeId, 1);
            mock.fakeId = getChildId(node.id, 1);
            nodes_customize[getChildId(node.id, 1)] = { theme: "helen" };
            mock.fakeParentId = node.fakeId;
            outputArray.push(mock);
        } else if (!node.skip_children) {
            traverseNode(orgChart, inputArray, outputArray, node.right_node, node.fakeId, 1);
        }

        return outputArray;
    }

    var peopleElement = document.getElementById("tree");
    var outputArray = [generateRootNode(my_tree_data)];

    traverseTree(null, my_tree_data, outputArray);

    var orgChart = new getOrgChart(peopleElement, {
        renderNodeEvent: renderNodeHandler,
        color: "neutralgrey",
        gridView: true,
        idField: "fakeId",
        parentIdField: "fakeParentId",
        enableEdit: false,
        enableSearch: false,
        enableDetailsView: false,
        enableZoomOnNodeDoubleClick: true,
        linkType: "M",
        primaryFields: ["name", "left_points", "right_points", "package_weight", "look_tree"],
        photoFields: ["image"],
        expandToLevel: 30,
        scale: 0.3,
        dataSource: outputArray,
        customize: nodes_customize
    });

    function renderNodeHandler(sender, args) {
        for (i = 0; i < args.content.length; i++) {
            if (args.content[i].indexOf(args.node.data["look_tree"]) != -1) {
                args.content[i] = "<foreignObject x='420' y='10' width='70' height='70'>" + args.node.data["look_tree"] + "</foreignObject>";
            }
            if (args.content[i].indexOf(args.node.data["package_weight"]) != -1) {
                args.content[i] = "<foreignObject x='0' y='-45' width='54' height='42'>" + args.node.data["package_weight"] + "</foreignObject>";
            }
        }
    }

    traverseTree(orgChart, my_tree_data);

    </script>
    <style type="text/css">
    html,
    body {
        margin: 0px;
        padding: 0px;
        height: 100%;
        overflow: hidden;
    }

    #tree {
        width: 100%;
        height: 100vh !important;
        position: relative;
    }

    .get-oc-c {
        height: 100vh !important;
    }

    .content-header {
        position: relative;
        padding: 0;
    }

    .get-green.get-org-chart .get-oc-tb {
        background-color: #008d4c;
    }

    .get-green .get-box,
    g.get-green .get-box {
        fill: #008d4c;
        stroke: #017741;
    }

    .look_tree {
        display: flex;
        align-items: center;
        justify-content: center;
        position: inherit;
        z-index: 9;
        width: 70px;
        height: 70px;
        background: #fff;
        border-radius: 5px;
        color: #017741;
        transition: .2s;
    }

    .look_tree:hover {
        color: #fff;
        background: #ea4e4e;
    }

    .content-wrapper {
        position: relative;
    }

    #tree_info {
        position: absolute;
        top: 50px;
        left: 0;
        width: 200px;
        height: auto;
        z-index: 20;
        display: block;
        background: #fff;
        padding: 10px;
    }

    #tree_info h3 {
        font-size: 16px;
        margin-top: 0;
    }

    @media screen and (max-width: 769px) {
        #tree_info {
            display: none;
        }
    }

    .get-green.get-org-chart {
        background-color: rgba(0, 0, 0, 0);
    }

    .fa-battery-1 {
        color: #ff645d;
    }

    .fa-battery-2 {
        color: #ff8b51;
    }

    .fa-battery-3 {
        color: #52a9ff;
    }

    .fa-battery-4 {
        color: #017741;
    }
    </style>
</body>